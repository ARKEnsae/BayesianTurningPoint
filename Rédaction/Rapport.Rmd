---
title: |
    |  \textsc{statistique bayésienne}
    |  Dating and forecasting turning point by Bayesian clustering with dynamic structure
author: |
    | Romain Lesauvage et Alain Quartier-la-Tente
automaticcontents: true
output:
  bookdown::pdf_document2:
        toc: false
        number_sections: true
        fig_width: 7
        fig_height: 6
        fig_caption: true
        highlight: default
        template: default.tex
        keep_tex: yes
themeoptions: "coding=utf8,language=french"
classoption: 'french'
fontsize: 10pt
geometry: margin=0.80in
lang: "french"
documentclass: "article"
header-includes:
- \usepackage[T1]{fontenc}
- \usepackage{caption}
- \usepackage{graphicx}
- \usepackage{natbib}
- \usepackage[dvipsnames]{xcolor}
- \usepackage{fontawesome5}
- \DeclareMathOperator{\arctanh}{arctanh}
- \usepackage{subcaption}
- \usepackage{amsfonts}
- \usepackage{dsfont}
- \usepackage{xspace}
- \usepackage{enumitem}
- \usepackage{pifont}
- \usepackage{wrapfig}
- \usepackage{textpos}
- \usepackage{array}
- \usepackage{multicol}

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                        fig.path = "img/markdown-",
                      cache = FALSE)
options(enable_print_style = FALSE)
```


\begin{textblock*}{\textwidth}(0cm,-7.5cm)
\begin{center}
\includegraphics[height=2.5cm]{img/LOGO-ENSAE.png}
\end{center}
\end{textblock*}

# Introduction

Dans son ouvrage *Les vagues longues de la conjoncture*, Nikolai Kondratiev mettait en évidence l'existence de cycles économiques formés de deux périodes, une phase ascendante puis une phase descendante. Bien que contestée et complétée par la suite par d'autres analyses, cette découverte des cycles économiques a très vite mené les chercheurs a essayé de savoir dans quelle phase l'économie se trouvait et, de fait, savoir déterminer et prévoir le moment le cycle s'inverse est un enjeu majeur. C'est sur ce sujet que nous allons travaillé ici, à partir de l'article intitulé "Dating and forecasting turning points by Bayesian clustering with dynamic structure: a suggestion with an application to Austrian data. Journal of Applied Econometrics" \cite{Kaufmann}.

Ce papier poursuit un premier travail introduit par \cite{FruhwirthKaufmann}. L'idée est de travail sur un ensemble de plusieurs séries temporelles que l'on va essayer de regrouper. Nous chercherons à les regrouper au mieux afin d'étudier ensemble des séries qui possèdent la même dynamique. Nous travaillerons alors sur deux périodes, selon que l'on est inférieur ou supérieur à la moyenne de croissance et on cherchera à déterminer le point de retournement dans le cycle. 

Dans ce travail, nous commencerons par détailler les spécifications théoriques du modèle et l'estimation bayésienne associée. Nous tenterons ensuite d'appliquer cette méthode à la manière de ce qui a été fait par \cite{Kaufmann} mais sur des données françaises.


# Cadre théorique

## Spécification du modèle

Dans la suite, nous travaillerons avec des séries centrées, réduites et corrigées des variations saisonnières. Notons $y_{it}$ la série correspondant à un taux de croissance, avec $i \in \{1, \dots, N\}$ représentant les différentes séries à notre disposition et $t \in \{1, \dots, T\}$ représentant les différentes périodes d'études. Nous supposerons que nos séries suivent des processus autorégressifs, c'est-à-dire que l'on a 
$$ y_{it} = \mu_{I_{it}}^{i} + \phi_1^i y_{i,t-1} + \dots + \phi_p y_{i,t-p} + \epsilon_{it}$$
avec $\epsilon_{it} \sim \mathcal{N}\big(0, \displaystyle\frac{\sigma}{\lambda_i^2}\big)$. L'indice $I_{it}$ précisera à quel moment du cycle nous nous trouverons, ainsi on aura $I_{it} \in \{1,2\}$.

Théoriquement, les séries étudiées sont supposées être indépendantes les unes des autres. En pratique, cependant, il existe des séries qui suivent des chemins proches et on peut donc vouloir exploiter cette information pour notre estimation. On va donc chercher à créer des groupes de séries de manière intelligente. Dans ce but, on va donc introduire une indicatrice d'appartenance à un groupe que l'on va note $S_i \in \{1, \dots, K \}$. Nous allons donc dans la suite supposé que pour les séries appartenant à un même groupe, nous allons avoir des paramètres distribués au sein d'une moyenne et ajouter un paramètre d'hétérogénéité, tel que :

$$ \mu_{I_{S_i,t}}^i \sim \begin{cases}
\mathcal{N}(\mu_1^k,q_1^k) \text{ si } S_i = k \text{ et } I_{kt} = 1\\
\mathcal{N}(\mu_2^k,q_2^k) \text{ si } S_i = k \text{ et } I_{kt} = 2
\end{cases} $$
$$ (\phi_1^i, \dots, \phi_p^i) \sim \mathcal{N}(\phi^k,Q_{\phi}^k) \text{ si } S_i = k$$
Pour la suite, nous définirons la période 1 comme celle où l'on se trouve en-dessous de la croissance moyenne et la période 2 comme celle où l'on se trouve au-dessus. Nous ferons également l'hypothèse que $I_{kt}$ suit un processus de Markov, c'est-à-dire $\mathbb{P}(I_{k,t} = j | I_{k,t-1} = j) = \xi_{j,l}^k$ avec $j,l \in \{1,2\}$. Par propriété sur les chaînes de Markov, on sait donc que $\forall j \in \{1,2\}, \sum\limits_{l=1}^2 \xi_{j,l}^k = 1$. Cette spécification permet de repérer en temps réel les points où le cycle change de période. 

Il faut également proposer une spécification pour la variable $S_i$, nous supposerons qu'elle suit un modèle logit multinomilal, c'est-à-dire $\mathbb{P}(S_i = k |\gamma_1, \dots, \gamma_K, \gamma_{z,1}, \dots, \gamma_{z,K-1}) = \displaystyle\frac{\exp(\gamma_k + Z_k\gamma_{z,k})}{1 + \sum\limits_{l=1}^{K-1} \exp(\gamma_l + Z_l\gamma_{z,l})}$ où l'on prendra le groupe K comme référence ($\gamma_K = \gamma_{z,K}=0$), $Z_i$ est un vecteur permettant de repérer l'appartenance à un groupe et les paramètres $\gamma$ sont inconnus mais spécifiques aux groupes. 

Enfin, il reste à ajouter une spécification pour en compte la dynamique du cycle. Pour cela, on va supposer avoir deux groupes spécifiques pour la suite de l'analyse et $K-2$ groupes indépendants. Les séries telles que $S_i = 2$ seront les séries qui mènent le cycle, tandis que les séries pour lesquelles $S_i = 1$ seront les séries qui coïncident avec le cycle. On va donc définir une nouvelle variable $I^*$.

$$\begin{cases}
I^* = 1 := (I_{1t}=1,I_{2t}=1) \\
I^* = 2 := (I_{1t}=1,I_{2t}=2) \\
I^* = 3 := (I_{1t}=2,I_{2t}=1) \\
I^* = 4 := (I_{1t}=2,I_{2t}=2) 
\end{cases}$$

En cas d'incertitude sur la structure dynamique des nos séries, c'est-à-dire sur l'identification des groupes 1 et 2, on peut introduire un paramètre de structure $\rho^*$, caractérisant la structure entre les groupes. Il sera donc la réalisation d'une des $K(K-1)$ permutations de $\{1,2,0_{K-2}\}$. On considéra que $\rho^*=1$ pour le groupe des séries coïncidentes, $\rho^*=2$ pour celles qui mènent le cycle, et toute autre valeur renverra aux séries aux comportements autonomes.

## Estimation bayésienne
### Notations
Dans la suite, on va noter $\forall i \in \{1,\dots,N\}, y_i^t = \{y_{i,t},y_{i,t-1},\dots,y_{i,1}\}, Y_t = \{y_{1,t}, \dots, y_{N,t} \} \text{ et } Y^t = \{Y_t, \dots, Y_1\}$. De même, on notera $S^N = \{S_1, \dots, S_N\}$ l'ensemble des indicatrices d'appartenances aux groupes, $I^T = \{I_1^T, \dots, I_K^T\}$ où $I_k^T=\{I_{k,T}, \dots, I_{k,1}\}$ les indicatrices d'états. Enfin, on notera $\lambda^N = \{\lambda_1, \dots, \lambda_N\}$ qui regroupe les poids qui seront utilisés. 

Par commodité, on notera également $\theta=(\mu_1^1, \mu_2^1, \dots, \mu_1^K, \mu_2^K, \phi^1, \dots, \phi^K, Q^1, \dots, Q^K, \sigma^2, \xi^*, \xi^{\rho^*(k)=0},\gamma, \gamma_z)$ où $Q^k = 
\begin{pmatrix}
q_1^k & 0 & 0 \\
0 & q_2^k & 0 \\
0 & 0 & Q_{\phi}^k
\end{pmatrix}$ représente l'hétérogénéité intra-groupe, $\xi^{\rho^*(k)=0} = \{\xi_{11}^k,\xi_{12}^k,\xi_{21}^k,\xi_{22}^k\}$, $\gamma = (\gamma_1, \dots, \gamma_{K-1})$ et $\gamma_z = (\gamma_{z,1},\dots, \gamma_{z,K-1})$. 

Nous pouvons passons à l'estimation par MCMC pour obtenir une posteriori sur le paramètre $\psi = (\theta,S^N,I^T,\lambda^N,\rho^*)$.

### Estimation par MCMC

Nous partons de $\pi(\psi|Y^T) \propto L(Y^T|\psi)\pi(\psi)$ où $(L(Y^T|\psi)$ est la vraisemblance, que l'on peut réécrire.
En effet, $L(Y^T|\psi) = \prod\limits_{t=p+1}^T\prod\limits_{i=1}^Nf(y_{i,t}|y_i^{t-1},\mu_{I_{S_i,t}}^{S_i},\phi^{S_i},Q^{S_i},\lambda_i,\sigma^2)$, avec $$f(y_{i,t}|y_i^{t-1},\mu_{I_{S_i,t}}^{S_i},\phi^{S_i},Q^{S_i},\lambda_i,\sigma^2)=\displaystyle\frac{1}{\sqrt{2\pi\nu_{it}^{S_i}}}\exp\big( -\displaystyle\frac{1}{2\nu_{it}^{S_i}}\big(y_{it} - \mu_{I_{S_i,t}}^{S_i} - \sum\limits_{j=1}^p \phi_j^{S_i}y_{i,t-1} \big)^2\big)$$

Nous supposerons dans la suite que la structure $\rho^*$ est connue (déterminée par d'autres méthodes), on peut alors réécrire la distribution a priori sur $\phi$ ainsi :

$$\pi(\phi) = \pi(I^{*T}|\rho^*, \xi^*) \prod \limits_{\rho^*(k)=0} \pi(I^{T}_k|\rho^*,\xi^*)\pi(S^N|\gamma, \gamma_z,Z^N)\pi(\lambda^N)\pi(\theta)$$

où les densités $\pi(I^{*T}|\rho^*, \xi^*)$,$\pi(I^{T}_k|\rho^*,\xi^*)$ et $\pi(S^N|\gamma, \gamma_z,Z^N)$ sont connues. On supposera que les poids ($\lambda^N$) sont indépendants et suivent une loi de Gamma. Il reste à spécifier l'a priori sur $\pi(\theta)$ : pour cela, nous décomposons $\theta$ en blocs sur lesquels nous faisons des a priori standards.

Nous cherchons ensuite à générer à partir de la loi a posteriori $\pi(\phi|Y^T)$, en se basant sur le procédé détaillé dans \cite{FruhwirthKaufmann}. Nous pouvons raisonner en 4 étapes différentes :

1. $\pi(S^N|Y^T, I^T, \rho^*, \lambda^N, \theta)$

2. $\pi(I^T|Y^T, S^N, \rho^*, \lambda^N, \theta)$

3. $\pi(\lambda^N|Y^T, I^T, S^N, \theta)$

4. $\pi(\theta|Y^T,S^N,I^T)$

Dans la première étape, nous générerons les indicatrices de groupes pour chaque série puis, à partir de $\rho^*$, on obtient une réalisation pour l'indicatrice d'état de l'étape 2. Dans l'étape 4, toutes les distributions a posteriori sont conjugées aux a priori, sauf pour $\gamma$ et $\gamma_z$, nous utiliserons alors l'aglorithme de Metropolis-Hastings pour générer selon leur loi.

# Applications

L'article \cite{Kaufmann} a utilisé la spécification théorique présentée dans la partie précédente sur des données autrichiennes. Nous avons décidé dans le cadre de ce travail d'appliquer cela sur des données françaises. Nous avons donc récupéré un certain nombre de données liées au PIB ou aux enquêtes conjonctures, dont le détail est expliqué dans le tableau XX.

# Discussion

# Conclusion

\newpage

\nocite{*}
\begin{thebibliography}{999}
\bibitem[Sylvia Kaufmann (2010)]{Kaufmann} Kaufmann S. (2010). Dating and forecasting turning points by Bayesian clustering with dynamic structure: a suggestion with an application to Austrian data. Journal of Applied Econometrics, \textbf{25}(2): 309-344 
\bibitem[Frühwirth-Schnatter S, Kaufmann S. (2008)]{FruhwirthKaufmann} Frühwirth-Schnatter S, Kaufmann S. (2008). Model-based clustering of multiple time series. Journal of Business and Economic Statistics \textbf{26}(1): 78
\end{thebibliography}